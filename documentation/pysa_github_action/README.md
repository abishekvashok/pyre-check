# Pysa Github Action

Run pysa on the repository in Github Actions and create a SARIF File.

## Dependencies

The action requires a python setup with the python version > 3.7

You may create a python setup with the latest python version by using the
following code. Do this only if you haven't setup python in your workflow.

```yml
- name: Setup python environment
  uses: actions/setup-python@v2
```

## Usage

Include the action in your workflow by including the following piece of code:

```yml
- name: Runs pysa
  uses: facebook/pyre-check@master
```

Pysa tries to find a `.pyre_configuration` file containing the configuration,
if there is no such file, it generates a new file by executing `pyre init`.

By default, it searches for filters in a `.pysa-filters` directory for filters
to reduce false positives. You may place it in such a directory, or place the
filters in a custom directory and specify the path the relative path from
repository root or the full path using the optional parameter
`filters-directory` as:

```yml
- name: Runs pysa
  uses: facebook/pyre-check@master
  with:
    filters-directory: your/path/here
```

Optionally, you may pass the build-type argument to use the nightly version
instead of the stable version of pysa as:

```yml
- name: Runs pysa
  uses: facebook/pyre-check@master
  with:
    build-type: nightly
```

When the parameter is not specified, the stable version of pysa is used.

Other optional parameters available are `requirements-file` and `run-infer`.
To produce taint analysis, pysa also checks the dependencies of the source,
so it is integral that the requirements are outlined and installed. By
default the action assumes the requirements file is `requirements.txt` at
the repository root, if not the case, please use the `requirements-file`
parameter to point towards the `requirements-file`. Example:

```yml
- name: Runs pysa
  uses: facebook/pyre-check@master
  with:
    requirements-file: path/to/requirements/file.extension
```

`run-infer` optional parameter specifies whether the action should run
`pyre infer` to generate type annotations. For projects with type annotations,
this may not be required and hence, the required parameter is false. But if
you require the action to run `pyre infer`, we can override to true with the
`run-infer` parameter:

```yml
- name: Runs pysa
  uses: facebook/pyre-check@master
  with:
    run-infer: true
```

Beware, running infer can produce effects on the output generated by the action
as it will cause pysa to run on the code with type annotations, which will be
slightly different from the source code.


## SARIF File

After you run the pysa action,the action creates a `sarif.json` file which
contains the results of the analysis performed by pysa filtered through the
filters.

You may expose the SARIF File to Github to get it report on the Security tab or on a pull
request by including the following steps as well in your workflow:

```yml
- name: Expose SARIF Results
  uses: actions/upload-artifact@v2
  with:
    name: SARIF Results
    path: sarif.json

- name: Upload SARIF Results
  uses: github/codeql-action/upload-sarif@v1
  with:
    sarif_file: sarif.json
```

## What the action does

The action does the following:
- Installs pysa by installing pyre-check
- Creates a `.pyre_configuration` file if no such file exists in the current working directory
- Install dependencies
- Optionally refers `pyre infer` to generate type annotations
- Runs pysa
- Installs sapp
- Convert the results into SARIF format and save it to `sarif.json` using sapp after applying filters.

## FAQ

1. Why do I see zero results even though I get results when I run pysa?

The action passes pysa results through the specified filters. If we give in
zero filters, the results will be zero. If you want to get all results
please create a filter json file that passes every issue through it in the
`.pysa-filters` directory or any custom directory and pass its path to the
action via the `filters-directory` parameter.
eg) `empty_filter.json`

```json
{
    "name": "empty_filter",
    "description": "Empty filter that passes everything through",
    "paths": ["%"]
}
```

2. Can I specify more than one filters?

Yes! Just place all those files in the `filters-directory` (if the parameter
is not specified, the default value is `.pysa-filters`.)
